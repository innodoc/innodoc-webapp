import type { ElementType } from 'react'
import type { PageContextBuiltIn } from 'vite-plugin-ssr'
import type { PageContextBuiltInClient } from 'vite-plugin-ssr/client/router'

import type { RootState } from '@/store/makeStore'

import type { Page } from './api'
import type { Locale } from './common'

/** Custom client-side page context */
export type PageContextClient = Omit<PageContextBuiltInClient, 'Page'> &
  Pick<PageContextServer, 'documentProps' | 'locale' | 'Page' | 'pageProps' | 'preloadedState'>

/** Custom server-side page context */
export type PageContextServer = Omit<PageContextBuiltIn, 'Page'> & {
  /** Styles generated by Emotion */
  emotionStyleTags: string

  /** Rendered page HTML */
  pageHtml: string

  /** Preloaded store state */
  preloadedState: RootState

  /** Document meta data */
  documentProps?: {
    /** Page title */
    title?: string
    /** Page description */
    description?: string
  }

  /** Current locale */
  locale: Locale

  /** Page component */
  Page: ElementType

  /** Props to pass to page component */
  pageProps: PageProps
}

/** Props to render a page */
export type PageProps = {
  /** Page Id */
  pageId?: Page['id']

  /** Section path */
  sectionPath?: string
}
